## Week Two 总结

### 学习笔记

1. 虚拟列表`diff`算法。

   > 基本思路如下

   虚拟 DOM 对比算法的实现思路主要有以下几个步骤：

   - 首先，需要定义一个虚拟 DOM 节点的数据结构，通常包含节点的类型、属性、子节点等信息，以及一个唯一的标识符（key）。
   - 其次，需要定义一个创建虚拟 DOM 树的函数，根据真实 DOM 树或者组件的状态，递归地创建虚拟 DOM 节点，并将它们连接起来。
   - 然后，需要定义一个对比两个虚拟 DOM 树的函数，根据一定的规则和策略，找出两个虚拟 DOM 树之间的差异，并记录在一个数组中。常见的规则和策略有：
   - 如果两个节点的类型不同，那么认为它们是完全不同的节点，直接替换掉旧节点。
   - 如果两个节点的类型相同，但是属性不同，那么只更新属性，不更新子节点。
   - 如果两个节点的类型相同，且都是文本节点，那么只更新文本内容。
   - 如果两个节点的类型相同，且都有子节点，那么递归地对比子节点，并使用 key 来优化子节点的移动和复用。
   - 最后，需要定义一个将差异应用到真实 DOM 树的函数，根据差异数组中的每一项，执行相应的操作，如创建、删除、更新、移动等。

   > 虚拟列表`diff`算法关键在于`list-diff`这一算法的时间复杂度的优化，比较可惜的是由于我参考教程质量的原因，光是`debug`就花费了大量的时间，其次在`list-diff`并没有考虑到数组内置方法的时间复杂度，导致最终的结果完成的不是很理想，可见找好好的教程与参考十分重要 😭😭😭。

2. `JSX`解析器。

   > 实现`JSX`解析器主要在于正则表达式的匹配，同时还需要进行嵌套标签的层级匹配，在优化代码的时候可以考虑使用`栈结构`（PS：感谢学长提醒）。

   **关键代码**

   ```ts
   // ⽤正则表达式匹配标签名，属性和内容，贪婪匹配
   const tagRegex = /<(\w+)(.*?)>([\s\S]*)<\/\1>/;
   const propRegex = /(\w+)=(['"{])(.*?)(['"}])/g;

   while ((propMatch = propRegex.exec(propString)) !== null) {
     const propName = propMatch[1];
     const propValue = propMatch[3];
     // 如果属性值是一个变量，就从当前作⽤域中获取它的值
     if (propMatch[2] === "{" && propMatch[4] === "}") {
       props[propName] = variables[propValue];
     } else {
       // 否则就直接赋值
       props[propName] = propValue;
     }
   }
   ```

   > 比较可惜的是这个`JSX`解析器并没有考虑到，单闭合标签的处理，同时没有对`JSX`错误的语法进行处理，后续可以考虑进一步进行优化。

   `JSX`注意事项。

   - `JSX`必须有一个根节点，如果没有，可以用幽灵节点`<></>`代替。
   - 所有标签必须闭合，成对闭合或者自闭和都可以。
   - `JSX`采用小驼峰命名法，对于`class`要转化成`className`，`for`需要转化成`htmlFor`，以防止`js`关键字冲突。
   - `JSX`支持换行，如果需要换行需要加上`()`，防止`bug`出现。
     ```jsx
     import "./app.css";
     const showTitle = true;
     function App() {
       return (
         <div className="App">
           <div className={showTitle ? "title" : ""}>this is a div</div>
         </div>
       );
     }
     export default App;
     ```

### 基本总结

1. 深入了解了虚拟`dom`对比算法的实现，虽然目前对`list-diff`的实现仍然存在问题，不过对整体算法实现的思路有了深入的了解，通过对算法的`list-diff`进行改进，尝试完成虚拟`dom`对比算法。
2. 学习了部分`JSX`语法，尝试实现一个了`JSX`解析器，虽然还有单标签和错误标签无法解析的问题，不过后续可以尝试完善一下这个`JSX`解析器。

### Optimize

1. 通过书写虚拟`dom`的列表对比算法，我发现自己对算法复杂度的优化和掌握不够深入，需要对算法加强练习。
2. 找对资料和找对方向对实现一个任务都是十分重要的事情，在某些情况下，选择确实比努力更重要些。
